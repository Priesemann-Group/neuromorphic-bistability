import os
from os.path import join
from waflib.extras.test_base import summary
from waflib.extras.symwaf2ic import get_toplevel_path


def depends(ctx):
    ctx("haldls")
    ctx("code-format")


def options(opt):
    pass


def configure(conf):
    conf.load('compiler_cxx')
    conf.load('python')
    conf.check_python_version()
    conf.check_python_headers()
    conf.check(
        compiler='cxx',
        features='cxx pyembed',
        uselib_store='PYBIND11GONZALES',
        mandatory=True,
        header_name='pybind11/pybind11.h',
    )


def build(bld):
    bld(
        target='gonzales',
        source='src/cc/gonzales/gonzales.cpp',
        features='cxx cxxshlib pyext pyembed',
        use=['PYBIND11GONZALES', 'stadls_vx_v1'],
        install_path='${PREFIX}/lib',
        linkflags='-Wl,-z,defs',
    )
